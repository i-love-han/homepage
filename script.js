eval(decodeURIComponent(escape(window.atob('ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCBlID0+IGUucHJldmVudERlZmF1bHQoKSk7CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBlID0+IHsKICAgIGlmIChlLmtleSA9PT0gJ0YxMicgfHwKICAgICAgICAoZS5jdHJsS2V5ICYmIGUuc2hpZnRLZXkgJiYgZS5rZXkgPT09ICdJJykgfHwKICAgICAgICAoZS5jdHJsS2V5ICYmIGUuc2hpZnRLZXkgJiYgZS5rZXkgPT09ICdKJykgfHwKICAgICAgICAoZS5jdHJsS2V5ICYmIGUua2V5ID09PSAnVScpKSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgfQp9KTsKY29uc3QgQ0FDSEVfQlVTVEVSID0gRGF0ZS5ub3coKTsKY29uc3QgTk9fSU1BR0VfUEFUSCA9ICdpbWFnZXMvbm8taW1hZ2Uuc3ZnJzsKbGV0IElNQUdFX0ZJTEVTID0gewogICAgZ2FsbGVyeTogW10sCiAgICBwZW9wbGU6IFtdLAogICAgbWFpbjogW10sCiAgICBwb3B1cDogW10KfTsKY29uc3QgbmF2YmFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5hdmJhcicpOwpjb25zdCBoYW1idXJnZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGFtYnVyZ2VyJyk7CmNvbnN0IG5hdk1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmF2LW1lbnUnKTsKY29uc3QgbmF2TGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubmF2LWxpbmsnKTsKY29uc3QgZ2FsbGVyeUdyaWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FsbGVyeUdyaWQnKTsKY29uc3QgbGlnaHRib3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGlnaHRib3gnKTsKY29uc3QgbGlnaHRib3hJbWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGlnaHRib3gtaW1nJyk7CmNvbnN0IGxpZ2h0Ym94VmlkZW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGlnaHRib3gtdmlkZW8nKTsKY29uc3QgbGlnaHRib3hDbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5saWdodGJveC1jbG9zZScpOwpjb25zdCBsaWdodGJveFByZXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubGlnaHRib3gtcHJldicpOwpjb25zdCBsaWdodGJveE5leHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubGlnaHRib3gtbmV4dCcpOwpmdW5jdGlvbiBpc1ZpZGVvKGZpbGVuYW1lKSB7CiAgICByZXR1cm4gL1wuKG1wNHx3ZWJtKSQvaS50ZXN0KGZpbGVuYW1lKTsKfQpsZXQgZ2FsbGVyeUltYWdlcyA9IFtdOwpsZXQgY3VycmVudEltYWdlSW5kZXggPSAwOwpsZXQgY3VycmVudFNsaWRlID0gMDsKY29uc3QgSVRFTVNfUEVSX1BBR0UgPSA2OwpsZXQgdG90YWxTbGlkZXMgPSAwOwpsZXQgZ2FsbGVyeVNjcm9sbFRpbWUgPSAzMDAwOyAvLyBkZWZhdWx0IDMgc2Vjb25kcwphc3luYyBmdW5jdGlvbiBmZXRjaENvbnRlbnQocGF0aCkgewogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtwYXRofT90PSR7Q0FDSEVfQlVTVEVSfWApOwogICAgaWYgKCFyZXNwb25zZS5vaykgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZmV0Y2ggJHtwYXRofWApOwogICAgcmV0dXJuIGF3YWl0IHJlc3BvbnNlLnRleHQoKTsKfQphc3luYyBmdW5jdGlvbiBsb2FkSW1hZ2VMaXN0KCkgewogICAgdHJ5IHsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGBpbWFnZXMuanNvbj90PSR7Q0FDSEVfQlVTVEVSfWApOwogICAgICAgIGlmICghcmVzcG9uc2Uub2spIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGxvYWQgaW1hZ2VzLmpzb24nKTsKICAgICAgICBJTUFHRV9GSUxFUyA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5sb2coJ+ydtOuvuOyngCDrqqnroZ0g66Gc65OcIOyLpO2MqDonLCBlcnJvcik7CiAgICB9Cn0KZnVuY3Rpb24gZ2V0SW1hZ2VQYXRoKGZvbGRlciwgZmlsZW5hbWUpIHsKICAgIHJldHVybiBgaW1hZ2VzLyR7Zm9sZGVyfS8ke2ZpbGVuYW1lfT90PSR7Q0FDSEVfQlVTVEVSfWA7Cn0KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGFzeW5jICgpID0+IHsKICAgIGF3YWl0IGxvYWRJbWFnZUxpc3QoKTsKICAgIGxvYWRDb250ZW50KCk7CiAgICBsb2FkUGVvcGxlSW1hZ2VzKCk7CiAgICBsb2FkR2FsbGVyeSgpOwogICAgY2hlY2tBbmRTaG93UG9wdXAoKTsKICAgIGxvYWRIZXJvQmFja2dyb3VuZCgpOwogICAgY29uc3QgeWVhckVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VycmVudFllYXInKTsKICAgIGlmICh5ZWFyRWxlbSkgeWVhckVsZW0udGV4dENvbnRlbnQgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7Cn0pOwphc3luYyBmdW5jdGlvbiBsb2FkQ29udGVudCgpIHsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IGZldGNoQ29udGVudCgnY29udGVudC50eHQnKTsKICAgICAgICBjb25zdCBsaW5lcyA9IHRleHQuc3BsaXQoJ1xuJyk7CiAgICAgICAgY29uc3QgZGF0YSA9IHt9OwogICAgICAgIGxpbmVzLmZvckVhY2gobGluZSA9PiB7CiAgICAgICAgICAgIGlmIChsaW5lLmluY2x1ZGVzKCc9JykpIHsKICAgICAgICAgICAgICAgIGNvbnN0IFtrZXksIC4uLnZhbHVlUGFydHNdID0gbGluZS5zcGxpdCgnPScpOwogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSB2YWx1ZVBhcnRzLmpvaW4oJz0nKS50cmltKCkucmVwbGFjZSgvXFxuL2csICdcbicpOwogICAgICAgICAgICAgICAgZGF0YVtrZXkudHJpbSgpXSA9IHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaWYgKGRhdGFbJ+u4jOudvOyasOyggCDtg4DsnbTti4AnXSkgewogICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IGRhdGFbJ+u4jOudvOyasOyggCDtg4DsnbTti4AnXTsKICAgICAgICB9CiAgICAgICAgc2V0VGV4dCgnaGVhZGVyVGl0bGUnLCBkYXRhWyftl6TrjZQg7KCc66qpJ10pOwogICAgICAgIHNldFRleHQoJ25hdkhvbWUnLCBkYXRhWyftmYgg652867KoJ10pOwogICAgICAgIHNldFRleHQoJ25hdkFib3V0JywgZGF0YVsn7IaM6rCcIOudvOuyqCddKTsKICAgICAgICBzZXRUZXh0KCduYXZHYWxsZXJ5JywgZGF0YVsn6rCk65+s66asIOudvOuyqCddKTsKICAgICAgICBzZXRUZXh0KCduYXZDb250YWN0JywgZGF0YVsn7Jew65297LKYIOudvOuyqCddKTsKICAgICAgICBzZXRUZXh0KCdtYWluVGl0bGUnLCBkYXRhWyfrqZTsnbgg7KCc66qpJ10pOwogICAgICAgIGNvbnN0IG1haW5Db250ZW50ID0gZGF0YVsn66mU7J24IOuCtOyaqSddIHx8ICcnOwogICAgICAgIGNvbnN0IG1haW5QYXJ0cyA9IG1haW5Db250ZW50LnNwbGl0KCdcbicpOwogICAgICAgIHNldFRleHQoJ21haW5Db250ZW50JywgbWFpblBhcnRzWzBdKTsKICAgICAgICBpZiAobWFpblBhcnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgc2V0VGV4dCgnbWFpblRhZ2xpbmUnLCBtYWluUGFydHMuc2xpY2UoMSkuam9pbignXG4nKSk7CiAgICAgICAgfQogICAgICAgIHNldFRleHQoJ2Fib3V0TGFiZWwnLCBkYXRhWyfshozqsJwg652867KoJ10pOwogICAgICAgIHNldFRleHQoJ2Fib3V0VGl0bGUnLCBkYXRhWyfshozqsJwg7KCc66qpJ10pOwogICAgICAgIHNldFRleHQoJ2Fib3V0Q29udGVudCcsIGRhdGFbJ+yGjOqwnCDrgrTsmqknXSk7CiAgICAgICAgc2V0VGV4dCgnZ2FsbGVyeUxhYmVsJywgZGF0YVsn6rCk65+s66asIOudvOuyqCddKTsKICAgICAgICBzZXRUZXh0KCdnYWxsZXJ5VGl0bGUnLCBkYXRhWyfqsKTrn6zrpqwg7KCc66qpJ10pOwogICAgICAgIGlmIChkYXRhWyfqsKTrn6zrpqwg7Iqk7YGs66Gk7Iuc6rCEJ10pIHsKICAgICAgICAgICAgZ2FsbGVyeVNjcm9sbFRpbWUgPSBwYXJzZUludChkYXRhWyfqsKTrn6zrpqwg7Iqk7YGs66Gk7Iuc6rCEJ10pICogMTAwMDsKICAgICAgICB9CiAgICAgICAgc2V0VGV4dCgnY29udGFjdExhYmVsJywgZGF0YVsn7Jew65297LKYIOudvOuyqCddKTsKICAgICAgICBzZXRUZXh0KCdjb250YWN0VGl0bGUnLCBkYXRhWyfsl7Drnb3sspgg7KCc66qpJ10pOwogICAgICAgIHNldFRleHQoJ2NvbnRhY3RFbWFpbCcsIGRhdGFbJ+yXsOudveyymCDsnbTrqZTsnbwnXSk7CiAgICAgICAgc2V0VGV4dCgnY29udGFjdFBob25lJywgZGF0YVsn7Jew65297LKYIOyghO2ZlCddKTsKICAgICAgICBzZXRUZXh0KCdjb250YWN0TG9jYXRpb24nLCBkYXRhWyfsl7Drnb3sspgg7JyE7LmYJ10pOwogICAgICAgIGFwcGx5Q29udGFjdExpbmtzKGRhdGEpOwogICAgICAgIHNldFRleHQoJ2Zvb3RlclRleHQnLCBkYXRhWyftkbjthLAg64K07JqpJ10pOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmxvZygn7L2Y7YWQ7LigIOuhnOuTnCDsi6TtjKg6JywgZXJyb3IpOwogICAgfQp9CmZ1bmN0aW9uIHNldFRleHQoaWQsIHRleHQpIHsKICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgICBpZiAoZWxlbWVudCAmJiB0ZXh0KSB7CiAgICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9IHRleHQ7CiAgICAgICAgaWYgKGlkID09PSAnYWJvdXRDb250ZW50JyB8fCBpZCA9PT0gJ21haW5UYWdsaW5lJykgewogICAgICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9IHRleHQucmVwbGFjZSgvXG4vZywgJzxicj4nKTsKICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gYXBwbHlDb250YWN0TGlua3MoZGF0YSkgewogICAgY29uc3QgZW1haWwgPSBkYXRhWyfsl7Drnb3sspgg7J2066mU7J28J107CiAgICBjb25zdCBwaG9uZSA9IGRhdGFbJ+yXsOudveyymCDsoITtmZQnXTsKICAgIGNvbnN0IGxvY2F0aW9uID0gZGF0YVsn7Jew65297LKYIOychOy5mCddOwogICAgY29uc3QgZW1haWxFbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhY3RFbWFpbCcpOwogICAgaWYgKGVtYWlsRWxlbSAmJiBlbWFpbCkgewogICAgICAgIGNvbnN0IGl0ZW0gPSBlbWFpbEVsZW0uY2xvc2VzdCgnLmNvbnRhY3QtaXRlbScpOwogICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgIGl0ZW0ub25jbGljayA9ICgpID0+IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYG1haWx0bzoke2VtYWlsfWA7CiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQogICAgY29uc3QgcGhvbmVFbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhY3RQaG9uZScpOwogICAgaWYgKHBob25lRWxlbSAmJiBwaG9uZSkgewogICAgICAgIGNvbnN0IGl0ZW0gPSBwaG9uZUVsZW0uY2xvc2VzdCgnLmNvbnRhY3QtaXRlbScpOwogICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgIGl0ZW0ub25jbGljayA9ICgpID0+IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYHRlbDoke3Bob25lfWA7CiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQogICAgY29uc3QgbG9jYXRpb25FbGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhY3RMb2NhdGlvbicpOwogICAgaWYgKGxvY2F0aW9uRWxlbSAmJiBsb2NhdGlvbikgewogICAgICAgIGNvbnN0IGl0ZW0gPSBsb2NhdGlvbkVsZW0uY2xvc2VzdCgnLmNvbnRhY3QtaXRlbScpOwogICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgIGl0ZW0ub25jbGljayA9ICgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IG1hcFVybCA9IGBodHRwczovL21hcC5rYWthby5jb20vbGluay9zZWFyY2gvJHtlbmNvZGVVUklDb21wb25lbnQobG9jYXRpb24pfWA7CiAgICAgICAgICAgICAgICB3aW5kb3cub3BlbihtYXBVcmwsICdfYmxhbmsnKTsKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gbG9hZFBlb3BsZUltYWdlcygpIHsKICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhYm91dEltYWdlQ29udGFpbmVyJyk7CiAgICBpZiAoIWNvbnRhaW5lcikgcmV0dXJuOwogICAgY29uc3QgZmlsZXMgPSBJTUFHRV9GSUxFUy5wZW9wbGUgfHwgW107CiAgICBpZiAoZmlsZXMubGVuZ3RoID4gMCkgewogICAgICAgIGNvbnN0IGltZ1BhdGggPSBnZXRJbWFnZVBhdGgoJ3Blb3BsZScsIGZpbGVzWzBdKTsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gYDxpbWcgc3JjPSIke2ltZ1BhdGh9IiBhbHQ9IiR7ZmlsZXNbMF19Ij5gOwogICAgfSBlbHNlIHsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gYDxpbWcgc3JjPSIke05PX0lNQUdFX1BBVEh9IiBhbHQ9IuydtOuvuOyngCDsl4bsnYwiPmA7CiAgICB9Cn0KbGV0IGN1cnJlbnRQb3B1cFNsaWRlID0gMDsKbGV0IHBvcHVwSW1hZ2VzID0gW107CmZ1bmN0aW9uIGNoZWNrQW5kU2hvd1BvcHVwKCkgewogICAgcG9wdXBJbWFnZXMgPSBJTUFHRV9GSUxFUy5wb3B1cCB8fCBbXTsKICAgIGlmIChwb3B1cEltYWdlcy5sZW5ndGggPT09IDApIHJldHVybjsKICAgIGNvbnN0IHBvcHVwSGFzaCA9IHBvcHVwSW1hZ2VzLmpvaW4oJywnKTsKICAgIGNvbnN0IHNhdmVkSGFzaCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwb3B1cEltYWdlSGFzaCcpOwogICAgY29uc3QgZG9udFNob3dVbnRpbCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwb3B1cERvbnRTaG93VW50aWwnKTsKICAgIGlmIChwb3B1cEhhc2ggIT09IHNhdmVkSGFzaCkgewogICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdwb3B1cERvbnRTaG93VW50aWwnKTsKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncG9wdXBJbWFnZUhhc2gnLCBwb3B1cEhhc2gpOwogICAgfSBlbHNlIGlmIChkb250U2hvd1VudGlsICYmIG5ldyBEYXRlKCkuZ2V0VGltZSgpIDwgcGFyc2VJbnQoZG9udFNob3dVbnRpbCkpIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXBJbWFnZUNvbnRhaW5lcicpOwogICAgY29udGFpbmVyLmlubmVySFRNTCA9IHBvcHVwSW1hZ2VzLm1hcCgoZmlsZSwgaW5kZXgpID0+CiAgICAgICAgYDxpbWcgc3JjPSIke2dldEltYWdlUGF0aCgncG9wdXAnLCBmaWxlKX0iIGFsdD0iJHtmaWxlfSIgY2xhc3M9IiR7aW5kZXggPT09IDAgPyAnYWN0aXZlJyA6ICcnfSI+YAogICAgKS5qb2luKCcnKTsKICAgIGNvbnN0IGRvdHNDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXBEb3RzJyk7CiAgICBpZiAocG9wdXBJbWFnZXMubGVuZ3RoID4gMSkgewogICAgICAgIGRvdHNDb250YWluZXIuaW5uZXJIVE1MID0gcG9wdXBJbWFnZXMubWFwKChfLCBpbmRleCkgPT4KICAgICAgICAgICAgYDxzcGFuIGNsYXNzPSJwb3B1cC1kb3QgJHtpbmRleCA9PT0gMCA/ICdhY3RpdmUnIDogJyd9IiBkYXRhLWluZGV4PSIke2luZGV4fSI+PC9zcGFuPmAKICAgICAgICApLmpvaW4oJycpOwogICAgICAgIGRvdHNDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnBvcHVwLWRvdCcpLmZvckVhY2goZG90ID0+IHsKICAgICAgICAgICAgZG90LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgZ29Ub1BvcHVwU2xpZGUocGFyc2VJbnQoZG90LmRhdGFzZXQuaW5kZXgpKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAgIGRvdHNDb250YWluZXIuaW5uZXJIVE1MID0gJyc7CiAgICB9CiAgICBjdXJyZW50UG9wdXBTbGlkZSA9IDA7CiAgICB1cGRhdGVQb3B1cE5hdigpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwTW9kYWwnKS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJzsKfQpmdW5jdGlvbiBnb1RvUG9wdXBTbGlkZShpbmRleCkgewogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwSW1hZ2VDb250YWluZXInKTsKICAgIGNvbnN0IGltYWdlcyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCdpbWcnKTsKICAgIGNvbnN0IGRvdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucG9wdXAtZG90Jyk7CiAgICBpbWFnZXMuZm9yRWFjaCgoaW1nLCBpKSA9PiB7CiAgICAgICAgaW1nLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIGkgPT09IGluZGV4KTsKICAgIH0pOwogICAgZG90cy5mb3JFYWNoKChkb3QsIGkpID0+IHsKICAgICAgICBkb3QuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJywgaSA9PT0gaW5kZXgpOwogICAgfSk7CiAgICBjdXJyZW50UG9wdXBTbGlkZSA9IGluZGV4OwogICAgdXBkYXRlUG9wdXBOYXYoKTsKfQpmdW5jdGlvbiB1cGRhdGVQb3B1cE5hdigpIHsKICAgIGNvbnN0IHByZXZCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXBQcmV2Jyk7CiAgICBjb25zdCBuZXh0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwTmV4dCcpOwogICAgaWYgKHBvcHVwSW1hZ2VzLmxlbmd0aCA8PSAxKSB7CiAgICAgICAgcHJldkJ0bi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIG5leHRCdG4uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIH0gZWxzZSB7CiAgICAgICAgcHJldkJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgICAgIG5leHRCdG4uc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgIH0KfQpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXBQcmV2JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBpZiAoY3VycmVudFBvcHVwU2xpZGUgPiAwKSB7CiAgICAgICAgZ29Ub1BvcHVwU2xpZGUoY3VycmVudFBvcHVwU2xpZGUgLSAxKTsKICAgIH0gZWxzZSB7CiAgICAgICAgZ29Ub1BvcHVwU2xpZGUocG9wdXBJbWFnZXMubGVuZ3RoIC0gMSk7CiAgICB9Cn0pOwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXBOZXh0JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICBpZiAoY3VycmVudFBvcHVwU2xpZGUgPCBwb3B1cEltYWdlcy5sZW5ndGggLSAxKSB7CiAgICAgICAgZ29Ub1BvcHVwU2xpZGUoY3VycmVudFBvcHVwU2xpZGUgKyAxKTsKICAgIH0gZWxzZSB7CiAgICAgICAgZ29Ub1BvcHVwU2xpZGUoMCk7CiAgICB9Cn0pOwpmdW5jdGlvbiBjbG9zZVBvcHVwKCkgewogICAgY29uc3QgZG9udFNob3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXBEb250U2hvdycpLmNoZWNrZWQ7CiAgICBpZiAoZG9udFNob3cpIHsKICAgICAgICBjb25zdCBvbmVXZWVrID0gNyAqIDI0ICogNjAgKiA2MCAqIDEwMDA7CiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3BvcHVwRG9udFNob3dVbnRpbCcsIG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgb25lV2Vlayk7CiAgICB9CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXBNb2RhbCcpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICcnOwp9CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwb3B1cENsb3NlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbG9zZVBvcHVwKTsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwQ2xvc2VCdG4nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsb3NlUG9wdXApOwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXBNb2RhbCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHsKICAgIGlmIChlLnRhcmdldC5pZCA9PT0gJ3BvcHVwTW9kYWwnKSBjbG9zZVBvcHVwKCk7Cn0pOwpmdW5jdGlvbiBsb2FkSGVyb0JhY2tncm91bmQoKSB7CiAgICBjb25zdCBmaWxlcyA9IElNQUdFX0ZJTEVTLm1haW4gfHwgW107CiAgICBpZiAoZmlsZXMubGVuZ3RoID4gMCkgewogICAgICAgIGNvbnN0IGJnUGF0aCA9IGdldEltYWdlUGF0aCgnbWFpbicsIGZpbGVzWzBdKTsKICAgICAgICBjb25zdCBoZXJvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlcm8nKTsKICAgICAgICBpZiAoaGVybykgewogICAgICAgICAgICBoZXJvLnN0eWxlLmJhY2tncm91bmQgPSBgbGluZWFyLWdyYWRpZW50KHJnYmEoMCwwLDAsMC40KSwgcmdiYSgwLDAsMCwwLjQpKSwgdXJsKCcke2JnUGF0aH0nKSBjZW50ZXIvY292ZXIgbm8tcmVwZWF0YDsKICAgICAgICB9CiAgICB9Cn0KZnVuY3Rpb24gbG9hZEdhbGxlcnkoKSB7CiAgICBjb25zdCBmaWxlcyA9IElNQUdFX0ZJTEVTLmdhbGxlcnkgfHwgW107CiAgICBpZiAoZmlsZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgZ2FsbGVyeUdyaWQuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJnYWxsZXJ5LWVtcHR5Ij7slYTsp4Eg65Ox66Gd65CcIOyCrOynhOydtCDsl4bsirXri4jri6QuPC9wPic7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZGF0YSA9IGZpbGVzLm1hcChmaWxlbmFtZSA9PiAoewogICAgICAgIGZpbGVuYW1lOiBmaWxlbmFtZSwKICAgICAgICBwYXRoOiBnZXRJbWFnZVBhdGgoJ2dhbGxlcnknLCBmaWxlbmFtZSkKICAgIH0pKTsKICAgIGdhbGxlcnlJbWFnZXMgPSBkYXRhLm1hcChpbWcgPT4gaW1nLnBhdGgpOwogICAgcmVuZGVyR2FsbGVyeShkYXRhKTsKfQpmdW5jdGlvbiByZW5kZXJHYWxsZXJ5KGRhdGEpIHsKICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGdhbGxlcnlHcmlkLmlubmVySFRNTCA9ICc8cCBjbGFzcz0iZ2FsbGVyeS1lbXB0eSI+7JWE7KeBIOuTseuhneuQnCDsgqzsp4TsnbQg7JeG7Iq164uI64ukLjwvcD4nOwogICAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHBhZ2VzID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpICs9IElURU1TX1BFUl9QQUdFKSB7CiAgICAgICAgcGFnZXMucHVzaChkYXRhLnNsaWNlKGksIGkgKyBJVEVNU19QRVJfUEFHRSkpOwogICAgfQogICAgZ2FsbGVyeUdyaWQuaW5uZXJIVE1MID0gcGFnZXMubWFwKChwYWdlLCBwYWdlSW5kZXgpID0+IGAKICAgICAgICA8ZGl2IGNsYXNzPSJnYWxsZXJ5LXBhZ2UiPgogICAgICAgICAgICAke3BhZ2UubWFwKChpbWcsIGluZGV4KSA9PiBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJnYWxsZXJ5LWl0ZW0gZmFkZS1pbiIgZGF0YS1pbmRleD0iJHtwYWdlSW5kZXggKiBJVEVNU19QRVJfUEFHRSArIGluZGV4fSI+CiAgICAgICAgICAgICAgICAgICAgJHtpc1ZpZGVvKGltZy5maWxlbmFtZSkgPyBgCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImdhbGxlcnktdmlkZW8td3JhcHBlciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dmlkZW8gc3JjPSIke2ltZy5wYXRofSN0PTAuNSIgcHJlbG9hZD0ibWV0YWRhdGEiPjwvdmlkZW8+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ2aWRlby1vdmVybGF5Ij7ilrY8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgYCA6IGAKICAgICAgICAgICAgICAgICAgICAgICAgPGltZyBzcmM9IiR7aW1nLnBhdGh9IiBhbHQ9IiR7aW1nLmZpbGVuYW1lfSIgbG9hZGluZz0ibGF6eSI+CiAgICAgICAgICAgICAgICAgICAgYH0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJnYWxsZXJ5LW92ZXJsYXkiPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZ2FsbGVyeS1pY29uIj4ke2lzVmlkZW8oaW1nLmZpbGVuYW1lKSA/ICfilrYnIDogJ/CflI0nfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgKS5qb2luKCcnKX0KICAgICAgICA8L2Rpdj4KICAgIGApLmpvaW4oJycpOwogICAgYXR0YWNoR2FsbGVyeUV2ZW50cygpOwogICAgaW5pdEdhbGxlcnlTbGlkZXIoZGF0YS5sZW5ndGgpOwogICAgb2JzZXJ2ZUZhZGVJbigpOwp9CmxldCBhdXRvU2xpZGVJbnRlcnZhbCA9IG51bGw7CmZ1bmN0aW9uIGluaXRHYWxsZXJ5U2xpZGVyKHRvdGFsSW1hZ2VzKSB7CiAgICB0b3RhbFNsaWRlcyA9IE1hdGguY2VpbCh0b3RhbEltYWdlcyAvIElURU1TX1BFUl9QQUdFKTsKICAgIGN1cnJlbnRTbGlkZSA9IDA7CiAgICBjb25zdCBkb3RzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbGxlcnlEb3RzJyk7CiAgICBpZiAoZG90c0NvbnRhaW5lciAmJiB0b3RhbFNsaWRlcyA+IDEpIHsKICAgICAgICBkb3RzQ29udGFpbmVyLmlubmVySFRNTCA9IEFycmF5LmZyb20oeyBsZW5ndGg6IHRvdGFsU2xpZGVzIH0sIChfLCBpKSA9PgogICAgICAgICAgICBgPHNwYW4gY2xhc3M9ImdhbGxlcnktZG90ICR7aSA9PT0gMCA/ICdhY3RpdmUnIDogJyd9IiBkYXRhLXNsaWRlPSIke2l9Ij48L3NwYW4+YAogICAgICAgICkuam9pbignJyk7CiAgICAgICAgZG90c0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcuZ2FsbGVyeS1kb3QnKS5mb3JFYWNoKGRvdCA9PiB7CiAgICAgICAgICAgIGRvdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIGdvVG9TbGlkZShwYXJzZUludChkb3QuZGF0YXNldC5zbGlkZSkpOwogICAgICAgICAgICAgICAgcmVzZXRBdXRvU2xpZGUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9CiAgICBjb25zdCBwcmV2QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbGxlcnlQcmV2Jyk7CiAgICBjb25zdCBuZXh0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbGxlcnlOZXh0Jyk7CiAgICBpZiAocHJldkJ0biAmJiBuZXh0QnRuKSB7CiAgICAgICAgY29uc3QgbmV3UHJldiA9IHByZXZCdG4uY2xvbmVOb2RlKHRydWUpOwogICAgICAgIGNvbnN0IG5ld05leHQgPSBuZXh0QnRuLmNsb25lTm9kZSh0cnVlKTsKICAgICAgICBwcmV2QnRuLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKG5ld1ByZXYsIHByZXZCdG4pOwogICAgICAgIG5leHRCdG4ucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQobmV3TmV4dCwgbmV4dEJ0bik7CiAgICAgICAgbmV3UHJldi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgaWYgKGN1cnJlbnRTbGlkZSA+IDApIHsKICAgICAgICAgICAgICAgIGdvVG9TbGlkZShjdXJyZW50U2xpZGUgLSAxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdvVG9TbGlkZSh0b3RhbFNsaWRlcyAtIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlc2V0QXV0b1NsaWRlKCk7CiAgICAgICAgfSk7CiAgICAgICAgbmV3TmV4dC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgaWYgKGN1cnJlbnRTbGlkZSA8IHRvdGFsU2xpZGVzIC0gMSkgewogICAgICAgICAgICAgICAgZ29Ub1NsaWRlKGN1cnJlbnRTbGlkZSArIDEpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZ29Ub1NsaWRlKDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlc2V0QXV0b1NsaWRlKCk7CiAgICAgICAgfSk7CiAgICB9CiAgICB1cGRhdGVTbGlkZXIoKTsKICAgIHN0YXJ0QXV0b1NsaWRlKCk7Cn0KZnVuY3Rpb24gc3RhcnRBdXRvU2xpZGUoKSB7CiAgICBpZiAodG90YWxTbGlkZXMgPD0gMSkgcmV0dXJuOwogICAgYXV0b1NsaWRlSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgaWYgKGN1cnJlbnRTbGlkZSA8IHRvdGFsU2xpZGVzIC0gMSkgewogICAgICAgICAgICBnb1RvU2xpZGUoY3VycmVudFNsaWRlICsgMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ29Ub1NsaWRlKDApOwogICAgICAgIH0KICAgIH0sIGdhbGxlcnlTY3JvbGxUaW1lKTsKfQpmdW5jdGlvbiByZXNldEF1dG9TbGlkZSgpIHsKICAgIGlmIChhdXRvU2xpZGVJbnRlcnZhbCkgewogICAgICAgIGNsZWFySW50ZXJ2YWwoYXV0b1NsaWRlSW50ZXJ2YWwpOwogICAgfQogICAgc3RhcnRBdXRvU2xpZGUoKTsKfQpmdW5jdGlvbiBnb1RvU2xpZGUoc2xpZGVJbmRleCkgewogICAgY3VycmVudFNsaWRlID0gc2xpZGVJbmRleDsKICAgIHVwZGF0ZVNsaWRlcigpOwp9CmZ1bmN0aW9uIHVwZGF0ZVNsaWRlcigpIHsKICAgIGNvbnN0IHZpZXdwb3J0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbGxlcnktdmlld3BvcnQnKTsKICAgIGNvbnN0IHZpZXdwb3J0V2lkdGggPSB2aWV3cG9ydD8ub2Zmc2V0V2lkdGggfHwgMDsKICAgIGNvbnN0IGdhcCA9IDIwOyAvLyBOZWVkcyB0byBtYXRjaCBDU1MKICAgIGNvbnN0IG9mZnNldCA9IGN1cnJlbnRTbGlkZSAqICh2aWV3cG9ydFdpZHRoICsgZ2FwKTsKICAgIGdhbGxlcnlHcmlkLnN0eWxlLnRyYW5zZm9ybSA9IGB0cmFuc2xhdGVYKC0ke29mZnNldH1weClgOwogICAgY29uc3QgZG90cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5nYWxsZXJ5LWRvdCcpOwogICAgZG90cy5mb3JFYWNoKChkb3QsIGluZGV4KSA9PiB7CiAgICAgICAgZG90LmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScsIGluZGV4ID09PSBjdXJyZW50U2xpZGUpOwogICAgfSk7CiAgICBjb25zdCBwcmV2QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbGxlcnlQcmV2Jyk7CiAgICBjb25zdCBuZXh0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbGxlcnlOZXh0Jyk7CiAgICBpZiAocHJldkJ0bikgcHJldkJ0bi5kaXNhYmxlZCA9IGN1cnJlbnRTbGlkZSA9PT0gMDsKICAgIGlmIChuZXh0QnRuKSBuZXh0QnRuLmRpc2FibGVkID0gY3VycmVudFNsaWRlID49IHRvdGFsU2xpZGVzIC0gMTsKfQpmdW5jdGlvbiBhdHRhY2hHYWxsZXJ5RXZlbnRzKCkgewogICAgY29uc3QgZ2FsbGVyeUl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmdhbGxlcnktaXRlbScpOwogICAgZ2FsbGVyeUl0ZW1zLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7CiAgICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgb3BlbkxpZ2h0Ym94KGluZGV4KTsKICAgICAgICB9KTsKICAgIH0pOwp9CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCAoKSA9PiB7CiAgICBpZiAod2luZG93LnNjcm9sbFkgPiA1MCkgewogICAgICAgIG5hdmJhci5jbGFzc0xpc3QuYWRkKCdzY3JvbGxlZCcpOwogICAgfSBlbHNlIHsKICAgICAgICBuYXZiYXIuY2xhc3NMaXN0LnJlbW92ZSgnc2Nyb2xsZWQnKTsKICAgIH0KfSk7CmhhbWJ1cmdlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgIGhhbWJ1cmdlci5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTsKICAgIG5hdk1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJyk7Cn0pOwpuYXZMaW5rcy5mb3JFYWNoKGxpbmsgPT4gewogICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBoYW1idXJnZXIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgbmF2TWVudS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgIH0pOwp9KTsKZnVuY3Rpb24gb3BlbkxpZ2h0Ym94KGluZGV4KSB7CiAgICBjdXJyZW50SW1hZ2VJbmRleCA9IGluZGV4OwogICAgY29uc3QgcGF0aCA9IGdhbGxlcnlJbWFnZXNbaW5kZXhdOwogICAgY29uc3QgZmlsZW5hbWUgPSBwYXRoLnNwbGl0KCcvJykucG9wKCkuc3BsaXQoJz8nKVswXTsKICAgIGxpZ2h0Ym94SW1nLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBsaWdodGJveFZpZGVvLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBsaWdodGJveFZpZGVvLnBhdXNlKCk7CiAgICBpZiAoaXNWaWRlbyhmaWxlbmFtZSkpIHsKICAgICAgICBsaWdodGJveFZpZGVvLnNyYyA9IHBhdGg7CiAgICAgICAgbGlnaHRib3hWaWRlby5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBsaWdodGJveFZpZGVvLnBsYXkoKS5jYXRjaChlID0+IGNvbnNvbGUubG9nKCdBdXRvcGxheSBmYWlsZWQ6JywgZSkpOwogICAgfSBlbHNlIHsKICAgICAgICBsaWdodGJveEltZy5zcmMgPSBwYXRoOwogICAgICAgIGxpZ2h0Ym94SW1nLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgfQogICAgbGlnaHRib3guY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7Cn0KZnVuY3Rpb24gY2xvc2VMaWdodGJveCgpIHsKICAgIGxpZ2h0Ym94LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgbGlnaHRib3hWaWRlby5wYXVzZSgpOwogICAgbGlnaHRib3hWaWRlby5zcmMgPSAiIjsgLy8gU3RvcCBidWZmZXJpbmcKICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnJzsKfQpmdW5jdGlvbiB1cGRhdGVMaWdodGJveENvbnRlbnQoKSB7CiAgICBjb25zdCBwYXRoID0gZ2FsbGVyeUltYWdlc1tjdXJyZW50SW1hZ2VJbmRleF07CiAgICBjb25zdCBmaWxlbmFtZSA9IHBhdGguc3BsaXQoJy8nKS5wb3AoKS5zcGxpdCgnPycpWzBdOwogICAgbGlnaHRib3hWaWRlby5wYXVzZSgpOyAvLyBQYXVzZSBwcmV2aW91cyBpZiB3YXMgdmlkZW8KICAgIGxpZ2h0Ym94SW1nLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBsaWdodGJveFZpZGVvLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBpZiAoaXNWaWRlbyhmaWxlbmFtZSkpIHsKICAgICAgICBsaWdodGJveFZpZGVvLnNyYyA9IHBhdGg7CiAgICAgICAgbGlnaHRib3hWaWRlby5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgICBsaWdodGJveFZpZGVvLnBsYXkoKS5jYXRjaChlID0+IGNvbnNvbGUubG9nKCdBdXRvcGxheSBmYWlsZWQ6JywgZSkpOwogICAgfSBlbHNlIHsKICAgICAgICBsaWdodGJveEltZy5zcmMgPSBwYXRoOwogICAgICAgIGxpZ2h0Ym94SW1nLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgfQp9CmZ1bmN0aW9uIHNob3dQcmV2SW1hZ2UoKSB7CiAgICBjdXJyZW50SW1hZ2VJbmRleCA9IChjdXJyZW50SW1hZ2VJbmRleCAtIDEgKyBnYWxsZXJ5SW1hZ2VzLmxlbmd0aCkgJSBnYWxsZXJ5SW1hZ2VzLmxlbmd0aDsKICAgIHVwZGF0ZUxpZ2h0Ym94Q29udGVudCgpOwp9CmZ1bmN0aW9uIHNob3dOZXh0SW1hZ2UoKSB7CiAgICBjdXJyZW50SW1hZ2VJbmRleCA9IChjdXJyZW50SW1hZ2VJbmRleCArIDEpICUgZ2FsbGVyeUltYWdlcy5sZW5ndGg7CiAgICB1cGRhdGVMaWdodGJveENvbnRlbnQoKTsKfQpsaWdodGJveENsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xvc2VMaWdodGJveCk7CmxpZ2h0Ym94UHJldi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNob3dQcmV2SW1hZ2UpOwpsaWdodGJveE5leHQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzaG93TmV4dEltYWdlKTsKbGlnaHRib3guYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgaWYgKGUudGFyZ2V0ID09PSBsaWdodGJveCkgewogICAgICAgIGNsb3NlTGlnaHRib3goKTsKICAgIH0KfSk7CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4gewogICAgaWYgKCFsaWdodGJveC5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpKSByZXR1cm47CiAgICBpZiAoZS5rZXkgPT09ICdFc2NhcGUnKSBjbG9zZUxpZ2h0Ym94KCk7CiAgICBpZiAoZS5rZXkgPT09ICdBcnJvd0xlZnQnKSBzaG93UHJldkltYWdlKCk7CiAgICBpZiAoZS5rZXkgPT09ICdBcnJvd1JpZ2h0Jykgc2hvd05leHRJbWFnZSgpOwp9KTsKZnVuY3Rpb24gb2JzZXJ2ZUZhZGVJbigpIHsKICAgIGNvbnN0IGZhZGVFbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWN0aW9uLXRpdGxlLCAuYWJvdXQtY29udGVudCwgLmdhbGxlcnktaXRlbSwgLmNvbnRhY3QtaXRlbScpOwogICAgY29uc3Qgb2JzZXJ2ZXJPcHRpb25zID0gewogICAgICAgIHRocmVzaG9sZDogMC4xLAogICAgICAgIHJvb3RNYXJnaW46ICcwcHggMHB4IC01MHB4IDBweCcKICAgIH07CiAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcigoZW50cmllcykgPT4gewogICAgICAgIGVudHJpZXMuZm9yRWFjaChlbnRyeSA9PiB7CiAgICAgICAgICAgIGlmIChlbnRyeS5pc0ludGVyc2VjdGluZykgewogICAgICAgICAgICAgICAgZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ3Zpc2libGUnKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwgb2JzZXJ2ZXJPcHRpb25zKTsKICAgIGZhZGVFbGVtZW50cy5mb3JFYWNoKGVsZW1lbnQgPT4gewogICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnZmFkZS1pbicpOwogICAgICAgIG9ic2VydmVyLm9ic2VydmUoZWxlbWVudCk7CiAgICB9KTsKfQpvYnNlcnZlRmFkZUluKCk7CmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2FbaHJlZl49IiMiXScpLmZvckVhY2goYW5jaG9yID0+IHsKICAgIGFuY2hvci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGNvbnN0IHRhcmdldCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSk7CiAgICAgICAgaWYgKHRhcmdldCkgewogICAgICAgICAgICB0YXJnZXQuc2Nyb2xsSW50b1ZpZXcoewogICAgICAgICAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnLAogICAgICAgICAgICAgICAgYmxvY2s6ICdzdGFydCcKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7Cn0pOwpjb25zdCBzZWN0aW9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ3NlY3Rpb24nKTsKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsICgpID0+IHsKICAgIGxldCBjdXJyZW50ID0gJyc7CiAgICBzZWN0aW9ucy5mb3JFYWNoKHNlY3Rpb24gPT4gewogICAgICAgIGNvbnN0IHNlY3Rpb25Ub3AgPSBzZWN0aW9uLm9mZnNldFRvcDsKICAgICAgICBpZiAod2luZG93LnNjcm9sbFkgPj0gc2VjdGlvblRvcCAtIDIwMCkgewogICAgICAgICAgICBjdXJyZW50ID0gc2VjdGlvbi5nZXRBdHRyaWJ1dGUoJ2lkJyk7CiAgICAgICAgfQogICAgfSk7CiAgICBuYXZMaW5rcy5mb3JFYWNoKGxpbmsgPT4gewogICAgICAgIGxpbmsuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgICAgICAgaWYgKGxpbmsuZ2V0QXR0cmlidXRlKCdocmVmJykgPT09IGAjJHtjdXJyZW50fWApIHsKICAgICAgICAgICAgbGluay5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgICB9CiAgICB9KTsKfSk7CmNvbnN0IHNjcm9sbFRvcEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY3JvbGxUb3BCdG4nKTsKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsICgpID0+IHsKICAgIGlmICh3aW5kb3cuc2Nyb2xsWSA+IDMwMCkgewogICAgICAgIHNjcm9sbFRvcEJ0bi5jbGFzc0xpc3QuYWRkKCd2aXNpYmxlJyk7CiAgICB9IGVsc2UgewogICAgICAgIHNjcm9sbFRvcEJ0bi5jbGFzc0xpc3QucmVtb3ZlKCd2aXNpYmxlJyk7CiAgICB9Cn0pOwpzY3JvbGxUb3BCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICB3aW5kb3cuc2Nyb2xsVG8oewogICAgICAgIHRvcDogMCwKICAgICAgICBiZWhhdmlvcjogJ3Ntb290aCcKICAgIH0pOwp9KTs='))));